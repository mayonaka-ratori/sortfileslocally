# LocalCurator Prime 実装計画書

## フェーズ 8: 自動整理とパーソナライズ (Auto-Organization & Personalization)
- **現状:** これまでの実装は「仮想的な整理（インデックス化）」であり、ファイル自体の場所は変更していませんでした。
- **目標:** 実際にフォルダを作成してファイルを移動させる機能を実装します。また、ユーザーが「これは〇〇」と教えることで、分類精度を向上させる学習機能を追加します。

### 実装機能
1. **Custom Classifier (AIに「教える」機能)**
   - 独自の分類軸（例: 「旅行」「仕事」「素材」「特定キャラ」）を数枚の画像から学習。
2. **Physical Sorter (物理整理エンジン)**
   - AIの解析結果に基づいてファイルを移動・コピー。
   - 同名ファイルの自動リネーム、処理ログ出力、Undoスクリプト生成機能を搭載。
3. **Smart Genre Recognition (写真/動画特化)**
   - CLIPによるゼロショット判別で「イラスト」と「写真」を区別し、適切なロジックを適用。

---

## フェーズ 9: 高度なキャラ・作品識別 (Advanced Character & Series Intelligence)
アニメ・イラスト特化したローカルAIモデル（WD14 Tagger等）を導入し、プライバシーを保ったまま数万種類の作品・キャラ名を自動特定します。

---

## フェーズ 11: システム最適化とUX向上 (System Polish & UX Enhancements)
- **バグ修正:** Sorter Viewでのインポートエラーの解消。
- **顔クラスタリング調整:** 感度（eps）設定をUIから変更可能にし、アルゴリズムの透明性を向上。
- **Cleaner View 強化:** 画像比較アルゴリズムに dHash を追加し精度向上。一括削除機能による操作性アップ。

---

## フェーズ 12: プロフェッショナル・ポリッシュ (Video & Safety)
- **動画処理のアップグレード:** 複数動画からの同時フレーム抽出と一括推論（バッチ処理）により、処理速度を数倍に向上。
- **重複スキャン防止:** ソート先フォルダをスキャンの除外対象に設定可能にし、無限ループや二重登録を防止。

---

## フェーズ 13: UX向上とアーキテクチャ再構築 (UX & Architecture Refactoring)
最新のレビューに基づき、より快適で堅牢なアプリを目指します。

### 1. ギャラリーのフィルタとタギング戦略
- **メディアフィルタ:** サイドバーで「画像のみ」「動画のみ」を切り替え可能にします。
- **タギングの最適化 (Smart Type Detection):** 
   - **自動判別:** CLIPのゼロショット分類で `Probability(Photo) > 0.8` の場合、「写真」とみなします。
   - **処理分岐:** 「写真」と判定された場合は、WD14 (CharacterTagger) をスキップ。実写動画の場合も全フレームでキャラ認識を省略し、爆速化を実現します。

### 2. 物理ソーターの最終調整（完了済み）
- **エラー修正:** Windows環境でのフォルダ名禁止文字（コロン等）への対応。
- **階層のフラット化:** ユーザー要望により、カテゴリ直下にファイルを展開（年別フォルダの廃止）。

### 3. アーキテクチャのリファクタリング（詳細計画）
- **クラス分割:** `Processor` を `ImageProcessor`, `VideoIngestor`, `InferenceOrchestrator` (AI統括), `MetadataManager` (DB) に分割します。
- **設定の外部化:** `src/config.py` を導入し、パスやしきい値を一元管理します。
