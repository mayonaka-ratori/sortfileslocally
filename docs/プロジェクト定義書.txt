ã”è¦æœ›ã€æ‰¿ã‚Šã¾ã—ãŸã€‚
ã“ã®è³‡æ–™ã•ãˆã‚ã‚Œã°ã€ã©ã®ã‚ˆã†ãªé–‹ç™ºè€…ï¼ˆã¾ãŸã¯AIï¼‰ã§ã‚ã£ã¦ã‚‚ã€ç¾çŠ¶ã‚’å®Œå…¨ã«æŠŠæ¡ã—ã€å³åº§ã«æœ€é©è§£ã®ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã®**ã€ŒLocalCurator Prime é–‹ç™ºä»•æ§˜æ›¸ v1.1 (Master Specification)ã€**ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã—ã€ä»Šå¾Œã®é–‹ç™ºã®æŒ‡é‡ã¨ã—ã¦ãã ã•ã„ã€‚

---

# LocalCurator Prime - Development Specification v1.1

**Project Name:** LocalCurator Prime  
**Version:** 1.1.0  
**Last Updated:** 2026-01-12  
**Target Architecture:** Windows Native / NVIDIA GPU Accelerated  
**Status:** Environment Setup Complete / Core Logic Implementation Phase

---

## 1. Project Overview & Objectives
**ç›®çš„:**
ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ä¿å­˜ã•ã‚ŒãŸå¤§é‡ã®éæ§‹é€ åŒ–ãƒ¡ãƒ‡ã‚£ã‚¢ï¼ˆç”»åƒãƒ»å‹•ç”»ï¼‰ã‚’ã€æœ€æ–°ã®AIæŠ€è¡“ã‚’ç”¨ã„ã¦è§£æã—ã€ã€Œä½œå“ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ã€ãŠã‚ˆã³ã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€ã«åŸºã¥ã„ã¦ä½“ç³»çš„ã«æ•´ç†ãƒ»ç§»å‹•ã•ã›ã‚‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

**ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆ:**
1.  **Privacy First:** å…¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³å†…ã§å®Œçµã€‚å¤–éƒ¨é€šä¿¡ä¸€åˆ‡ãªã—ã€‚
2.  **Performance:** NVIDIA RTX 4070 Superã®Tensor Coreã‚’æœ€å¤§é™æ´»ç”¨ã—ã€æ•°ä¸‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚’å®Ÿç”¨çš„ãªæ™‚é–“å†…ã§å®Œäº†ã•ã›ã‚‹ã€‚
3.  **Human-in-the-Loop:** AIã¯ã‚ãã¾ã§ã€Œææ¡ˆã€ã‚’è¡Œã„ã€æœ€çµ‚æ±ºå®šæ¨©ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒã¤ã€‚ãŸã ã—ã€AIã®ææ¡ˆç²¾åº¦ã‚’é«˜ã‚ã‚‹ã“ã¨ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹é–“ã‚’æœ€å°åŒ–ã™ã‚‹ã€‚

## 2. System Environment (Frozen)
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®å›ºå®šã•ã‚ŒãŸç’°å¢ƒä¸‹ã§å‹•ä½œã‚’ä¿è¨¼ã™ã‚‹ã€‚

*   **OS:** Windows 11 (64-bit)
*   **CPU:** Intel/AMD x64 Architecture
*   **GPU:** NVIDIA GeForce RTX 4070 Super (VRAM 12GB)
*   **Driver:** NVIDIA Game Ready Driver / Studio Driver (Latest 2025/2026 build)
*   **Python Runtime:** Python 3.10.x (Selected for maximum stability with PyTorch 2.x)
*   **CUDA Toolkit:** CUDA 12.1 (Compatible with PyTorch Stable)

## 3. Directory Structure
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ `LocalCuratorPrime/` ã¨ã™ã‚‹ã€‚

```text
LocalCuratorPrime/
â”œâ”€â”€ .gitignore               # Gité™¤å¤–è¨­å®š (venv, __pycache__, inputs, outputs)
â”œâ”€â”€ requirements.txt         # ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§
â”œâ”€â”€ app.py                   # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (Streamlitèµ·å‹•)
â”œâ”€â”€ src/                     # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ check_device.py      # ç’°å¢ƒè¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ core/                # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ai_models.py     # CLIP, InsightFace, Decordã®ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ scanner.py       # ãƒ•ã‚¡ã‚¤ãƒ«æ¢ç´¢ã€ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ã€DBç™»éŒ²
â”‚   â”‚   â”œâ”€â”€ processor.py     # ãƒãƒƒãƒå‡¦ç†ç®¡ç†
â”‚   â”‚   â””â”€â”€ sorter.py        # ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ãƒ»ã‚³ãƒ”ãƒ¼å®Ÿè¡Œ
â”‚   â”œâ”€â”€ data/                # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»DBæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ db_manager.py    # SQLite/Pickleæ“ä½œ
â”‚   â”‚   â””â”€â”€ schemas.py       # ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹å®šç¾© (Pydantic/Dataclass)
â”‚   â””â”€â”€ ui/                  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Streamlit)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ sidebar.py
â”‚       â”œâ”€â”€ gallery_view.py
â”‚       â””â”€â”€ components.py
â””â”€â”€ data/                    # å®Ÿè¡Œæ™‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜é ˜åŸŸ
    â”œâ”€â”€ inputs/              # ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒä¾å­˜ã€‘å…¥åŠ›ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
    â”œâ”€â”€ outputs/             # ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒä¾å­˜ã€‘å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€
    â”œâ”€â”€ models/              # AIãƒ¢ãƒ‡ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (InsightFaceç­‰)
    â””â”€â”€ db/                  # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ (vectors.index, app.db)
```

## 4. Technology Stack & Configuration Details

### A. Core AI Engine
*   **Vision-Language Model:** `OpenCLIP`
    *   **Model:** `ViT-L-14` (Vision Transformer Large, Patch 14)
    *   **Pretrained Weights:** `laion2b_s32b_b82k` (å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§å­¦ç¿’æ¸ˆã¿)
    *   **Usage:** ç”»åƒå…¨ä½“ãŠã‚ˆã³å‹•ç”»ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã€Œæ„å‘³ã€ã‚’768æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«åŒ–ã€‚ã‚¸ãƒ£ãƒ³ãƒ«åˆ†é¡ã€ä½œå“æ¨å®šã«ä½¿ç”¨ã€‚
*   **Face Analysis:** `InsightFace`
    *   **Model Pack:** `buffalo_l` (Detection: SCRFD-10G / Recognition: ArcFace-R100)
    *   **Execution Provider:** `CUDAExecutionProvider` (ONNX Runtime GPU)
    *   **Usage:** ç”»åƒå†…ã®é¡”æ¤œå‡ºã€512æ¬¡å…ƒé¡”ç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡ºã€‚ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã€‚
*   **Video Decoding:** `Decord`
    *   **Context:** `decord.gpu(0)`
    *   **Logic:** å‹•ç”»å…¨ä½“ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã›ãšã€`VideoReader`ã‚’ç”¨ã„ã¦ã‚·ãƒ¼ã‚¯ã—ã€æŒ‡å®šã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆä¾‹: 20%, 50%, 80%ï¼‰ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã¿ã‚’VRAMä¸Šã§ç›´æ¥å–å¾—ã€‚

### B. Data & Search
*   **Vector Database:** `FAISS` (Facebook AI Similarity Search)
    *   **Index Type:** `IndexFlatIP` (Inner Product / Cosine Similarity)ã€‚æ•°ä¸‡ä»¶è¦æ¨¡ã§ã‚ã‚Œã°ç·å½“ãŸã‚Šã§ã‚‚GPUãªã‚‰ä¸€ç¬ã§ã‚ã‚‹ãŸã‚ã€ç²¾åº¦é‡è¦–ã§Flatã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¡ç”¨ã€‚
    *   **Dimension:** 768 (CLIP) + 512 (Face)
*   **Metadata Storage:** `SQLite` or `Pickle` (Pandas DataFrame)
    *   ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€ãƒãƒƒã‚·ãƒ¥å€¤ã€å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»˜ä¸ã—ãŸã‚¿ã‚°ã‚’ç®¡ç†ã€‚

### C. User Interface
*   **Framework:** `Streamlit`
*   **Reason:** Pythonã®ã¿ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªGUIã‚’æ§‹ç¯‰å¯èƒ½ã€‚`st.image` ã«ã‚ˆã‚‹ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã€`st.cache_resource` ã«ã‚ˆã‚‹ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ãƒ¢ãƒªå¸¸é§ãŒå®¹æ˜“ã€‚

## 5. Implementation Requirements (Functional)

### 1. Robust File Scanning (Scanner)
*   **å†å¸°çš„æ¢ç´¢:** æŒ‡å®šãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã®å…¨ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚’èµ°æŸ»ã€‚
*   **ç ´æãƒã‚§ãƒƒã‚¯:** `PIL.Image.open().verify()` ãŠã‚ˆã³ `try-except` ãƒ–ãƒ­ãƒƒã‚¯ã§ç ´æãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡ºã—ã€ã‚¹ã‚­ãƒƒãƒ—ãƒªã‚¹ãƒˆã«ç™»éŒ²ã€‚ã‚¢ãƒ—ãƒªã‚’ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã•ã›ãªã„ã€‚
*   **é‡è¤‡æ’é™¤:** ãƒ•ã‚¡ã‚¤ãƒ«ã®MD5ãƒãƒƒã‚·ãƒ¥ã‚’è¨ˆç®—ã—ã€æ—¢ã«DBã«ã‚ã‚‹å ´åˆã¯è§£æã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚

### 2. Video Processing Strategy
å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‡¦ç†ãŒé‡ã„ãŸã‚ã€ä»¥ä¸‹ã®æˆ¦ç•¥ã‚’ã¨ã‚‹ã€‚
*   **Keyframe Extraction:** å‹•ç”»1æœ¬ã«ã¤ãã€æœ€å¤§3æšã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ`Start+10s`, `Middle`, `End-10s`ï¼‰ã‚’æŠ½å‡ºã€‚
*   **Vector Aggregation:** 3æšã®CLIPãƒ™ã‚¯ãƒˆãƒ«ã‚’å¹³å‡åŒ–ã—ã€ãã®å‹•ç”»ã®ä»£è¡¨ãƒ™ã‚¯ãƒˆãƒ«ã¨ã™ã‚‹ã€‚é¡”æƒ…å ±ã¯3æšã™ã¹ã¦ã®æ¤œå‡ºçµæœã‚’ãƒ—ãƒ¼ãƒ«ã™ã‚‹ã€‚

### 3. Clustering Logic (Auto-Grouping)
*   **DBSCAN / HDBSCAN:** é¡”ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ512æ¬¡å…ƒï¼‰ã«å¯¾ã—ã€å¯†åº¦ãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’é©ç”¨ã€‚
*   **Unknown Handling:** é¡ä¼¼åº¦ãŒé–¾å€¤ï¼ˆä¾‹: Cosine Sim > 0.6ï¼‰ã‚’è¶…ãˆãªã„é¡”ã¯ã€ŒUnknownã€ã¨ã—ã¦åˆ†é¡ã€‚

### 4. Interactive Sorting (Review & Move)
*   **Confidence Score:** AIã®åˆ¤å®šã«ã¯å¿…ãšç¢ºä¿¡åº¦ï¼ˆScoreï¼‰ã‚’æŒãŸã›ã‚‹ã€‚
*   **Thresholding:** ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šï¼ˆä¾‹: 80%ï¼‰ä»¥ä¸Šã®ç¢ºä¿¡åº¦ãŒã‚ã‚‹ã‚‚ã®ã¯ã€Œè‡ªå‹•ç§»å‹•å€™è£œã€ã€ãã‚Œæœªæº€ã¯ã€Œç¢ºèªå¾…ã¡ã€ã¨ã—ã¦UIã«åŒºåˆ¥ã—ã¦è¡¨ç¤ºã€‚
*   **Undo Capability:** ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ãƒ­ã‚°ã‚’ä¿æŒã—ã€ç›´å‰ã®æ“ä½œã‚’å–ã‚Šæ¶ˆã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## 6. Development Roadmap & Current Status

### Phase 1: Environment Setup (âœ… Completed)
*   Python 3.10 Environment Created.
*   CUDA 12.1 / PyTorch GPU Verified.
*   Necessary Libraries Installed (`torch`, `insightface`, `open_clip`, `decord`, `streamlit`).

### Phase 2: Core Logic Implementation (ğŸš§ CURRENT TASK)
*   **Task 2.1:** `src/core/ai_models.py` - AIãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼ã®å®Ÿè£…ã€‚
*   **Task 2.2:** `test_engine.py` - ç”»åƒå…¥åŠ›ã‹ã‚‰ãƒ™ã‚¯ãƒˆãƒ«å‡ºåŠ›ã¾ã§ã®ç–é€šç¢ºèªã€‚
*   **Task 2.3:** å‹•ç”»å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ï¼ˆDecordæ´»ç”¨ï¼‰ã€‚

### Phase 3: Backend & Data Management (Next)
*   Scanning module & SQLite/Pandas integration.
*   Vector Search logic using FAISS.

### Phase 4: UI Development (Future)
*   Streamlit Dashboard construction.

---

ã“ã®å®šç¾©æ›¸ã«åŸºã¥ãã€ç¾åœ¨ã¯ **Phase 2: Core Logic Implementation** ã®æ®µéšã«ã‚ã‚Šã¾ã™ã€‚
ç›´è¿‘ã®ã‚¿ã‚¹ã‚¯ã¯ã€AIãƒ¢ãƒ‡ãƒ«ã‚’ãƒ¡ãƒ¢ãƒªã«ãƒ­ãƒ¼ãƒ‰ã—ã€ç”»åƒãƒ»å‹•ç”»ã‹ã‚‰ç‰¹å¾´é‡ã‚’æŠ½å‡ºã™ã‚‹Pythonã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ã§ã™ã€‚